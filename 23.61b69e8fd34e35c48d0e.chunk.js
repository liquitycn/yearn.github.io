(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{"9787df6e0947d27ea143":function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);var REACT_ELEMENT_TYPE,react=__webpack_require__("8af190b70a6bc55c6f1b"),styled_components_browser_esm=__webpack_require__("0b3cb19af78752326f59"),injectSaga=__webpack_require__("adc20f99e57c573c589c"),injectReducer=__webpack_require__("d95b0cf107403b178365"),selectors=__webpack_require__("6542cd13fd5dd1bcffd4"),lib=__webpack_require__("d7dd51e1bf6bfc2c9c3d"),Cover_selectors=__webpack_require__("844c243dd8a9dcabc7f8"),TokenIcon=__webpack_require__("bead8c689debe4683146"),Table=__webpack_require__("73bb0e359204f9566244");function _jsx(type,props,key,children){REACT_ELEMENT_TYPE||(REACT_ELEMENT_TYPE="function"===typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var defaultProps=type&&type.defaultProps,childrenLength=arguments.length-3;if(props||0===childrenLength||(props={children:void 0}),1===childrenLength)props.children=children;else if(childrenLength>1){for(var childArray=new Array(childrenLength),i=0;i<childrenLength;i++)childArray[i]=arguments[i+3];props.children=childArray}if(props&&defaultProps)for(var propName in defaultProps)void 0===props[propName]&&(props[propName]=defaultProps[propName]);else props||(props=defaultProps||{});return{$$typeof:REACT_ELEMENT_TYPE,type:type,key:void 0===key?null:""+key,ref:null,props:props,_owner:null}}var Wrapper=styled_components_browser_esm.d.div.withConfig({displayName:"LiteCoverCards__Wrapper",componentId:"sid44h-0"})([""]),IconAndName=styled_components_browser_esm.d.div.withConfig({displayName:"LiteCoverCards__IconAndName",componentId:"sid44h-1"})(["display:flex;align-items:center;"]),StyledTokenIcon=Object(styled_components_browser_esm.d)(TokenIcon.a).withConfig({displayName:"LiteCoverCards__StyledTokenIcon",componentId:"sid44h-2"})(["width:30px;margin-right:20px;"]),IconName=styled_components_browser_esm.d.div.withConfig({displayName:"LiteCoverCards__IconName",componentId:"sid44h-3"})(["overflow:hidden;padding-right:10px;text-overflow:ellipsis;"]),tokenTransform=function(dontCare,row){var protocolTokenAddress=row.protocolTokenAddress,protocolDisplayName=row.protocolDisplayName;return _jsx(IconAndName,{},void 0,_jsx(StyledTokenIcon,{address:protocolTokenAddress}),_jsx(IconName,{},void 0,protocolDisplayName))};function CoverCards(){var protocols=Object(lib.useSelector)(Object(Cover_selectors.b)()),claimTokens=Object(lib.useSelector)(Object(selectors.f)("coverTokens")),protocolsWithClaimData=_.map(protocols,function(protocol){var newProtocol=protocol,claimAddress=protocol.coverObjects[protocol.claimNonce].tokens.claimAddress,claimTokenContractData=_.find(claimTokens,{address:claimAddress}),claimTokenBalanceOf=_.get(claimTokenContractData,"balanceOf[0].value");return newProtocol.claimTokenBalanceOf=claimTokenBalanceOf,newProtocol}),sortedProtocols=_.orderBy(protocolsWithClaimData,function(protocol){return protocol.claimTokenBalanceOf},"desc"),coverTable={title:"Buy coverage",columns:[{key:"protocolDisplayName",alias:"Protocol",transform:tokenTransform},{key:"supplied"},{key:"wallet",alias:"balance"},{key:"apy"},{key:"actions",alias:""}],rows:sortedProtocols};console.log("sortt",sortedProtocols);var coverCards=_jsx(Table.a,{data:coverTable});return _jsx(Wrapper,{},void 0,coverCards)}CoverCards.whyDidYouRender=!0;var LiteCoverCards=CoverCards,CoverProtocol=__webpack_require__("d75d6e34dd63dc0e4e49"),react_router_dom=__webpack_require__("e95a63b25fb92ed15721"),constants=__webpack_require__("aa46e31d8feb0abfbdba");var LiteCover_REACT_ELEMENT_TYPE,immer_module=__webpack_require__("7edf83707012a871cdfb"),initialState={},reducer=function(){var state=arguments.length>0&&void 0!==arguments[0]?arguments[0]:initialState,action=arguments.length>1?arguments[1]:void 0;return Object(immer_module.a)(state,function(draft){switch(action.type){case constants.b:var coverData=action.payload;_.each(coverData,function(val,key){draft[key]=val})}})},balancerPool=__webpack_require__("ee0dcd2e6ab090e6f53f"),erc20=__webpack_require__("caea238b3314f46f7a4c"),bignumber=__webpack_require__("cced10b079020449fa4d"),bignumber_default=__webpack_require__.n(bignumber),ConnectionProvider_constants=__webpack_require__("432a961b65ae67b19030"),ConnectionProvider_selectors=__webpack_require__("5481216f1a1b76c8f273"),actions=__webpack_require__("0593db4731582dee8516"),redux_saga_effects_npm_proxy_cjs=__webpack_require__("d782b72bc5b680c7122c"),cover=__webpack_require__("7b67d72548196b69d19c"),request=__webpack_require__("f363639bc5c3c97af546"),web3_lib=__webpack_require__("4f817a31dc23829ec68e"),web3_lib_default=__webpack_require__.n(web3_lib),_marked=regeneratorRuntime.mark(fetchCoverData),_marked2=regeneratorRuntime.mark(coverDataLoadedSaga),_marked3=regeneratorRuntime.mark(approveTxSpend),_marked4=regeneratorRuntime.mark(executeCoverBuy),_marked5=regeneratorRuntime.mark(saga_buyCover),_marked6=regeneratorRuntime.mark(watchers);function fetchCoverData(){var response;return regeneratorRuntime.wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.prev=0,"https://api.coverprotocol.com/protocol_data/production",_context.next=4,Object(redux_saga_effects_npm_proxy_cjs.call)(request.a,"https://api.coverprotocol.com/protocol_data/production");case 4:return response=_context.sent,_context.next=7,Object(redux_saga_effects_npm_proxy_cjs.put)((payload=response,{type:constants.b,payload:payload}));case 7:_context.next=12;break;case 9:_context.prev=9,_context.t0=_context.catch(0),console.log("Error reading vaults",_context.t0);case 12:case"end":return _context.stop()}var payload},_marked,null,[[0,9]])}function coverDataLoadedSaga(action){var payload,claimTokens,collateralTokens,account,addTokens,claimTokenAddresses,claimPools,extractAddress,claimPoolAddresses,collateralTokenAddresses,generateClaimPoolAllowanceReadMethods,claimPoolAllowanceReadMethods,contracts;return regeneratorRuntime.wrap(function(_context2){for(;;)switch(_context2.prev=_context2.next){case 0:return payload=action.payload,claimTokens={},collateralTokens={},_context2.next=5,Object(redux_saga_effects_npm_proxy_cjs.select)(Object(ConnectionProvider_selectors.a)());case 5:return account=_context2.sent,addTokens=function(protocol){var claimAddress=protocol.coverObjects[protocol.claimNonce].tokens.claimAddress,collaterals=protocol.collaterals;_.each(collaterals,function(collateralArr){var collateralAddress=collateralArr[0];collateralArr[1]&&(collateralTokens[collateralAddress]=!0)});var claimPool=Object(cover.e)(payload.poolData,claimAddress);claimTokens[claimAddress]=claimPool},_.each(payload.protocols,addTokens),claimTokenAddresses=Object.keys(claimTokens),claimPools=Object.values(claimTokens),extractAddress=function(pool){return web3_lib_default.a.utils.toChecksumAddress(pool.address)},claimPoolAddresses=_.map(claimPools,extractAddress),collateralTokenAddresses=Object.keys(collateralTokens),generateClaimPoolAllowanceReadMethods=function(address){return{name:"allowance",args:[account,address]}},claimPoolAllowanceReadMethods=_.map(claimPoolAddresses,generateClaimPoolAllowanceReadMethods),contracts=[{namespace:"coverTokens",abi:erc20,addresses:claimTokenAddresses,metadata:{tokenType:"CLAIM"},readMethods:[{name:"decimals"},{name:"balanceOf",args:[account]}]},{namespace:"tokens",abi:erc20,addresses:collateralTokenAddresses,metadata:{tokenType:"collateral"},syncOnce:!0,readMethods:[{name:"name"},{name:"decimals"},{name:"balanceOf",args:[account]}]},{namespace:"tokens",abi:erc20,addresses:[constants.c],syncOnce:!0,readMethods:claimPoolAllowanceReadMethods},{namespace:"coverClaimPools",abi:balancerPool,addresses:claimPoolAddresses}],_context2.next=18,Object(redux_saga_effects_npm_proxy_cjs.put)(Object(actions.a)(contracts));case 18:case"end":return _context2.stop()}},_marked2)}function approveTxSpend(contract,spenderAddress){var account;return regeneratorRuntime.wrap(function(_context3){for(;;)switch(_context3.prev=_context3.next){case 0:return _context3.next=2,Object(redux_saga_effects_npm_proxy_cjs.select)(Object(ConnectionProvider_selectors.a)());case 2:return account=_context3.sent,_context3.next=5,Object(redux_saga_effects_npm_proxy_cjs.call)(contract.methods.approve.cacheSend,spenderAddress,constants.e,{from:account});case 5:case"end":return _context3.stop()}},_marked3)}function executeCoverBuy(claimPoolContract,daiAmount,claimTokenAddress,claimTokenTokenAmount){var account,daiData,claimTokenData,daiAmountRaw,claimTokenAmountRaw;return regeneratorRuntime.wrap(function(_context4){for(;;)switch(_context4.prev=_context4.next){case 0:return _context4.next=2,Object(redux_saga_effects_npm_proxy_cjs.select)(Object(ConnectionProvider_selectors.a)());case 2:return account=_context4.sent,_context4.next=5,Object(redux_saga_effects_npm_proxy_cjs.select)(Object(selectors.d)(constants.c));case 5:return daiData=_context4.sent,_context4.next=8,Object(redux_saga_effects_npm_proxy_cjs.select)(Object(selectors.d)(claimTokenAddress));case 8:return claimTokenData=_context4.sent,daiAmountRaw=new bignumber_default.a(daiAmount).times(Math.pow(10,daiData.decimals)),claimTokenAmountRaw=new bignumber_default.a(claimTokenTokenAmount).times(Math.pow(10,claimTokenData.decimals)),_context4.next=13,Object(redux_saga_effects_npm_proxy_cjs.call)(claimPoolContract.methods.swapExactAmountOut.cacheSend,constants.c,daiAmountRaw,claimTokenAddress,claimTokenAmountRaw,constants.e,{from:account});case 13:case"end":return _context4.stop()}},_marked4)}function saga_buyCover(action){var _action$payload,poolAllowedToSpendDai,protocol,claimPoolContract,daiContract,claimTokenTokenAmount,daiAmount,claimTokenAddress;return regeneratorRuntime.wrap(function(_context5){for(;;)switch(_context5.prev=_context5.next){case 0:if(_action$payload=action.payload,poolAllowedToSpendDai=_action$payload.poolAllowedToSpendDai,protocol=_action$payload.protocol,claimPoolContract=_action$payload.claimPoolContract,daiContract=_action$payload.daiContract,claimTokenTokenAmount=_action$payload.amount,daiAmount=_action$payload.equivalentTo,claimTokenAddress=protocol.coverObjects[protocol.claimNonce].tokens.claimAddress,_context5.prev=2,poolAllowedToSpendDai){_context5.next=6;break}return _context5.next=6,Object(redux_saga_effects_npm_proxy_cjs.call)(approveTxSpend,daiContract,claimPoolContract.address);case 6:return _context5.next=8,Object(redux_saga_effects_npm_proxy_cjs.call)(executeCoverBuy,claimPoolContract,daiAmount,claimTokenAddress,claimTokenTokenAmount);case 8:_context5.next=13;break;case 10:_context5.prev=10,_context5.t0=_context5.catch(2),console.error(_context5.t0);case 13:case"end":return _context5.stop()}},_marked5,null,[[2,10]])}function watchers(){return regeneratorRuntime.wrap(function(_context6){for(;;)switch(_context6.prev=_context6.next){case 0:return _context6.next=2,Object(redux_saga_effects_npm_proxy_cjs.takeLatest)(ConnectionProvider_constants.a,fetchCoverData);case 2:return _context6.next=4,Object(redux_saga_effects_npm_proxy_cjs.takeLatest)(constants.d,fetchCoverData);case 4:return _context6.next=6,Object(redux_saga_effects_npm_proxy_cjs.takeLatest)(constants.b,coverDataLoadedSaga);case 6:return _context6.next=8,Object(redux_saga_effects_npm_proxy_cjs.takeLatest)(constants.a,saga_buyCover);case 8:case"end":return _context6.stop()}},_marked6)}function LiteCover_jsx(type,props,key,children){LiteCover_REACT_ELEMENT_TYPE||(LiteCover_REACT_ELEMENT_TYPE="function"===typeof Symbol&&Symbol.for&&Symbol.for("react.element")||60103);var defaultProps=type&&type.defaultProps,childrenLength=arguments.length-3;if(props||0===childrenLength||(props={children:void 0}),1===childrenLength)props.children=children;else if(childrenLength>1){for(var childArray=new Array(childrenLength),i=0;i<childrenLength;i++)childArray[i]=arguments[i+3];props.children=childArray}if(props&&defaultProps)for(var propName in defaultProps)void 0===props[propName]&&(props[propName]=defaultProps[propName]);else props||(props=defaultProps||{});return{$$typeof:LiteCover_REACT_ELEMENT_TYPE,type:type,key:void 0===key?null:""+key,ref:null,props:props,_owner:null}}var _ref=LiteCover_jsx(styled_components_browser_esm.d.div.withConfig({displayName:"LiteCover__Wrapper",componentId:"sc-1k40oic-0"})(["margin:0 auto;max-width:1200px;padding:50px 40px;"]),{},void 0,LiteCover_jsx(react_router_dom.Switch,{},void 0,LiteCover_jsx(react_router_dom.Route,{exact:!0,path:"/insure",component:LiteCoverCards}),LiteCover_jsx(react_router_dom.Route,{path:"/insure/:protocolAddress",component:CoverProtocol.a}))),LiteCover_Cover=function(){var dispatch=Object(lib.useDispatch)();return Object(injectSaga.a)({key:"cover",saga:watchers}),Object(injectReducer.a)({key:"cover",reducer:reducer}),Object(react.useEffect)(function(){dispatch({type:constants.d})},[]),_ref};LiteCover_Cover.whyDidYouRender=!0;__webpack_exports__.default=LiteCover_Cover}}]);